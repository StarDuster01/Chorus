# RagBot Azure Update & Deployment Commands

# NOTE: Add this file to your .gitignore so it is not committed to git!

# 1. Build backend Docker image

docker build -t chorusbackend.azurecr.io/chorusbackend:latest ../ragbot-backend

# 2. Build frontend Docker image

docker build -t chorusfrontend.azurecr.io/chorusfrontend:latest .

# 3. Login to Azure

az login

# 4. Set your Azure subscription

az account set --subscription 8e01de94-6907-4e0a-8c93-ffe80d8c2907

# 5. Login to Azure Container Registries

az acr login --name chorusbackend
az acr login --name chorusfrontend

# 6. Push backend image to Backend ACR

docker push chorusbackend.azurecr.io/chorusbackend:latest

# 7. Push frontend image to Frontend ACR

docker push chorusfrontend.azurecr.io/chorusfrontend:latest

# 8. Update backend Azure Container App

az containerapp update --name chorusbackend --resource-group viridity_tech --image chorusbackend.azurecr.io/chorusbackend:latest

# 9. Update frontend Azure Container App

az containerapp update --name chorusfrontend --resource-group viridity_tech --image chorusfrontend.azurecr.io/chorusfrontend:latest

# Nginx Config Note:
# Ensure in ragbot-frontend/nginx.conf:
#   location /api/ {
#     proxy_pass https://chorusbackend.wonderfulocean-4a90a562.westus2.azurecontainerapps.io/api/;
#   }
# If you change the backend URL, update this and repeat the above steps. 